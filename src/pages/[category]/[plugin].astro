---
import Base from "../../layouts/Base.astro";
import Breadcrumb from "../../components/Breadcrumb.astro";
import CopyButton from "../../components/CopyButton.astro";
import StatusBadge from "../../components/StatusBadge.astro";
import TagList from "../../components/TagList.astro";
import GitHubIcon from "../../components/icons/GitHubIcon.astro";
import type { PluginMeta, Category } from "../../lib/types";
import { getCategories, getPluginsByCategory } from "../../lib/data";

interface PathEntry {
  params: { category: string; plugin: string };
  props: { category: Category; plugin: PluginMeta };
}

export function getStaticPaths() {
  const paths: PathEntry[] = [];
  for (const cat of getCategories()) {
    for (const plugin of getPluginsByCategory(cat.name)) {
      paths.push({
        params: { category: cat.name, plugin: plugin.name },
        props: { category: cat, plugin },
      });
    }
  }
  return paths;
}

const { category, plugin } = Astro.props;
const initials = plugin.name.slice(0, 2).toUpperCase();
const author = plugin.homepage.split("github.com/")[1]?.split("/")[0] ?? "heurema";
---

<Base
  title={`${plugin.name} — ${category.displayName}`}
  description={`${plugin.description} Claude Code plugin from skill7.`}
>
  <Breadcrumb items={[
    { label: "Home", href: "/" },
    { label: category.displayName, href: `/${category.name}` },
    { label: plugin.name },
  ]} />

  <!-- Plugin header -->
  <div class="flex items-start gap-5">
    <div class="flex h-16 w-16 items-center justify-center rounded-lg border border-dark-line bg-dark-raised text-acid font-mono font-medium text-lg shrink-0 shadow-glow-ring">
      {initials}
    </div>
    <div class="min-w-0">
      <div class="flex items-center gap-3 flex-wrap">
        <h1 class="font-heading font-bold tracking-tight text-dark-hi text-2xl sm:text-4xl">{plugin.name}</h1>
        <StatusBadge status={plugin.status} />
        {plugin.verified && (
          <span class="badge-verified" title="Reviewed by heurema for security and quality">verified</span>
        )}
      </div>
      <p class="mt-1.5 text-sm text-dark-lo font-mono">
        by <a href={`https://github.com/${author}`} class="text-dark-lo hover:text-acid transition-colors" target="_blank" rel="noopener">
          {author}
        </a>
        {plugin.version && <span class="text-dark-dim mx-1.5">·</span>}
        {plugin.version && <span>v{plugin.version}</span>}
        {plugin.license && <span class="text-dark-dim mx-1.5">·</span>}
        {plugin.license && <span>{plugin.license}</span>}
      </p>
    </div>
  </div>

  <!-- Description -->
  <p class="mt-6 text-lg text-dark-lo leading-relaxed max-w-2xl">{plugin.description}</p>

  <!-- Install steps -->
  <div class="mt-10">
    <h2 class="section-label mb-4">Install</h2>
    <div class="space-y-4">
      <div>
        <p class="mb-2 text-sm text-dark-dim font-mono">
          <span class="text-acid">01</span> — Register the marketplace (once):
        </p>
        <CopyButton text="claude plugin marketplace add heurema/emporium" />
        <p class="mt-1 text-xs text-dark-dim font-mono">Skip if you already added the marketplace.</p>
      </div>
      <div>
        <p class="mb-2 text-sm text-dark-dim font-mono">
          <span class="text-acid">02</span> — Install the plugin:
        </p>
        <CopyButton text={`claude plugin install ${plugin.name}@emporium`} />
      </div>
    </div>
  </div>

  <!-- Tags -->
  {plugin.tags.length > 0 && (
    <div class="mt-10">
      <h2 class="section-label mb-3">Tags</h2>
      <TagList tags={plugin.tags} />
    </div>
  )}

  <!-- Links -->
  <div class="mt-10 pt-8 border-t border-dark-line flex flex-wrap gap-3">
    <a href={plugin.homepage} class="btn-primary" target="_blank" rel="noopener">
      <GitHubIcon />
      View on GitHub
    </a>
    <a href={`/${category.name}`} class="btn-ghost">
      ← Back to {category.displayName}
    </a>
  </div>

</Base>
